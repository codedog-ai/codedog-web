---
title: Codedog
navigation: false
layout: page
main:
  fluid: false
---

:ellipsis{right=0px width=75% blur=150px}

::block-hero
---
cta:
  - Getting Started
  - /documentation/getting-started
secondary:
  - Community →
  - /community
---

#title
你的AI Code Review伙伴

#description
Codedog use [OpenAI GPT](https://www.openai.com) to give suggestions to your pull requests. To make your daily code review more available, comfortable and efficient.

#extra
  ::list
  - Briefly summarize the change files.
  - Seperate housekeeping changes from wasting your time.
  - Support [Github](https://www.github.com)
  - Start in 5 minutes.
  - Used in **Cloudwise**
  ::


::



## 试用Codedog :badge[v0.0.2 Alpha]

在你的Github项目中添加Pull Request Webhook:
```plain
https://api.codedog.ai/api/v1/github
```

## Review效果

#TODO: use some famous PR as example.

::code-group

::code-block{label="ClickHouse/ClickHouse #42681" preview}
# PR审查

*powered by GPT3.5-Turbo and CodeDog 0.0.2a3*


## 执行记录
- 开始时间: 2023-05-11 22:34:31
- 审查耗时: 305秒
- 审查文件数量: 12 (跳过0)
- OPENAI API TOKEN数量: 22233 (约$0.0445)



## PR概要
该PR主要是对MergeTree索引进行了重构，新增了RPNBuilderTree和buildFilterNode函数用于支持AST和DAG两种情况下的索引分析，同时对部分文件进行了维护性的修改。


**主要变动**

1. [src/Processors/QueryPlan/Optimizations/optimizePrimaryKeyCondition.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FProcessors%2FQueryPlan%2FOptimizations%2FoptimizePrimaryKeyCondition.cpp)

优化PrimaryKeyCondition的处理逻辑


2. [src/Storages/MergeTree/KeyCondition.h](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FKeyCondition.h)

该diff修改了KeyCondition.h文件，添加了一些头文件，构造函数，以及一些静态方法。这些改动并非Housekeeping类型的改动。


3. [src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FMergeTreeIndexConditionBloomFilter.cpp)

添加头文件和修改方法参数与调用方式


4. [src/Storages/MergeTree/MergeTreeIndexConditionBloomFilter.h](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FMergeTreeIndexConditionBloomFilter.h)

修改了MergeTreeIndexConditionBloomFilter.h文件中的函数调用和参数传递方式。


5. [src/Storages/MergeTree/MergeTreeIndexFullText.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FMergeTreeIndexFullText.cpp)

Change in MergeTreeIndexFullText.cpp


6. [src/Storages/MergeTree/MergeTreeIndexFullText.h](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FMergeTreeIndexFullText.h)

本次diff为MergeTreeIndexFullText.h文件的修改，主要是对其中的函数进行了修改和重命名，没有涉及到Housekeeping类型的改动。


7. [src/Storages/MergeTree/MergeTreeIndexUtils.h](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FMergeTreeIndexUtils.h)

新增一个名为buildFilterNode的函数，用于从SELECT语句的WHERE和PREWHERE部分以及额外的过滤器中建立AST过滤器节点。


8. [src/Storages/MergeTree/RPNBuilder.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FRPNBuilder.cpp)

该diff为添加了RPNBuilder.cpp文件的内容，增加了一些函数实现。无housekeeping类型的改动。


9. [src/Storages/MergeTree/RPNBuilder.h](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FRPNBuilder.h)

该diff文件添加了Interpreters/Context.h、Interpreters/Set.h、Interpreters/PreparedSets.h和Interpreters/ActionsDAG.h四个头文件，并增加了RPNBuilderTreeNode、RPNBuilderFunctionTreeNode、RPNBuilderTreeContext三个类，对原有的RPNBuilder进行了一个重构，用于支持AST和DAG两种情况下的索引分析。



**次要变动**

1. [src/Processors/QueryPlan/ReadFromMergeTree.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FProcessors%2FQueryPlan%2FReadFromMergeTree.cpp)

在ReadFromMergeTree.cpp的906行添加了一个array_join_name_set变量，用于存储查询中的数组连接名字集合，并在key_condition.emplace()中作为新加参数传递。


2. [src/Storages/MergeTree/KeyCondition.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FKeyCondition.cpp)

删除了一些辅助函数


3. [src/Storages/MergeTree/MergeTreeIndexUtils.cpp](https://github.com/ClickHouse/ClickHouse/blob/bca22ec5f50b05e4e578da816278379d86ab3a6d/src%2FStorages%2FMergeTree%2FMergeTreeIndexUtils.cpp)

该diff添加了一个名为buildFilterNode的函数，用于构建一个AST节点作为查询语句的过滤器


## PR改进建议

1. 请确保新增的类和函数实现在代码库中有单元测试覆盖，覆盖到所有可能的输入和输出情况，以确保代码的正确性和稳定性。
2. 请使用静态代码分析工具检查新增类和函数实现中是否存在潜在的内存泄漏和未初始化的变量等问题，以确保代码的稳定性和可靠性。
3. 请确保新增类和函数实现符合公司或项目的代码规范和标准，以确保代码的一致性和可维护性。可以使用代码审查工具来帮助检查。
4. 请保持新增类和函数实现的简洁性，避免过度工程。函数调用和参数传递方式应易于理解和维护。
5. 如果新增类和函数实现逻辑复杂，请添加注释来帮助其他开发人员理解代码。但请注意，注释不应该用于弥补代码本身的不足，应该尽可能地让代码本身更易于理解。
::



```markdown [Markdown]
## PR审查

*powered by GPT3.5-Turbo and CodeDog 0.0.2a1*

### 执行记录
- 开始时间: 2023-05-10 16:28:06
- 审查耗时: 87秒
- 审查文件数量: 8 (跳过0)
- OPENAI API TOKEN数量: 8670 (约$0.0173)

### PR概要

此次PR实现了GitHub适配器，可以接收GitHub事件#5，并解析PR信息构建PullRequest对象。同时对一些变量名进行维护性修改。

**主要变动**

1. [codedog/github_adapter.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/codedog%2Fgithub_adapter.py)

新增github_adapter.py文件，包含handle_github_event函数，用于解析GitHub的webhook事件，获取PR信息并构建PullRequest对象。同时，添加了一些代码review函数。


2. [example/github-merge-event.json](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/example%2Fgithub-merge-event.json)

该diff为添加了一个新的pull request，包含了pull request的详细信息和一些metadata，其中包括url、id、state、title、body、labels、created_at等。

**次要变动**

1. [codedog/gitlab_adapter.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/codedog%2Fgitlab_adapter.py)

将变量名project_id改为repository_id


2. [codedog/model.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/codedog%2Fmodel.py)

修改PullRequest和Change模型中的project_id为repository_id


3. [codedog/review.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/codedog%2Freview.py)

在codedog/review.py中增加一个TODO注释，并修改了_summarize_pr函数中的代码


4. [example/github_review.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/example%2Fgithub_review.py)

添加了一段cloudwise gitlab的示例代码，处理了一个pull request的事件


5. [example/gitlab_review.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/example%2Fgitlab_review.py)

将文件中的project_id改为repository_id，以及修改注释内容


6. [example/gitlab_webhook.py](https://github.com/Arcadia822/codedog/blob/e73756dd2cb4c098c3cf4118562c0487b3c2a958/example%2Fgitlab_webhook.py)

修改变量名project_id为repository_id


### PR改进建议

1. 在handle_github_event函数中，需要添加异常处理机制，避免因为解析错误的webhook事件导致整个应用崩溃。 (github_adapter.py)
2. 在PullRequest类中，需要添加对于PR状态的判断，避免处理已经被合并或者关闭的PR。 (model.py, review.py, github_review.py)
3. 建议添加单元测试，覆盖新增的函数和类。 (无相关文件)
```
::
